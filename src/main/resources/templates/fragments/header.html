<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <div th:fragment="headerFragment" class="header-box" style="height:120px">

        <ul class="user-header"
            style="width:40%; height:70px; display: flex; gap: 20px">
            <li style="width:80px">
                <a sec:authorize="isAuthenticated()" href="#"
                   id="authenticated-id"
                   style="width:100px; font-size: 16px; text-decoration-line: none; color: #696969; margin-left:auto"
                   th:text="${#authentication.name}">로그인한 아이디</a>
            </li>

            <li style="width:80px">
                <a sec:authorize="isAuthenticated()" href="#"
                   style="width:100px; font-size: 16px; text-decoration-line: none; color: #696969; margin-left:auto"
                >알림</a>
            </li>
            <li sec:authorize="isAuthenticated()" style="width:100px">
                <a th:href="@{/profile}"
                   style="width:150px; font-size: 16px; text-decoration-line: none; color: #696969; margin-left:auto"
                >마이페이지</a>
            </li>
            <li>
                <form th:action="@{/user/logout}" th:method="post" sec:authorize="isAuthenticated()" style="width:140px;">
                    <button style="width:140px; font-size: 16px; background: none; border: none; color:#696969"  type="submit">로그아웃</button>
                </form>
            </li>
            <li style="width:80px; margin-left:auto">
                <a href="#" sec:authorize="!isAuthenticated()"
                   style="font-size: 16px; text-decoration-line: none; color: #696969; margin-left:auto"
                   th:href="@{/user/login}">로그인</a>
            </li>
        </ul>

        <ul class="category-header">
            <li><img th:src="@{/img/logo.png}" alt="logo" id="header-logo" th:onclick="|location.href='@{/}'|"/></li>
            <li><a th:href="@{/trip/lists}" style="text-decoration-line: none; color:#696969;">여행</a></li>
            <li><a th:href="@{/community/boards/parties(state='all')}" style="text-decoration-line: none; color:#696969;">커뮤니티</a></li>
        </ul>

    <script type="application/javascript">

        document.addEventListener('DOMContentLoaded', function() {

            // 로그인 여부를 확인
            var isAuthenticated = document.getElementById('authenticated-id');

            // 로그인한 경우에만 스크립트 실행
            if (isAuthenticated) {
                console.log('로그인된 유저');

                const eventSource = new EventSource('/notifications/connect');
                eventSource.addEventListener('notification', function(event) {
                    let msg = event.data;
                    console.log(msg);
                })

            } else {
                console.log('로그인하지 않은 유저');
            }

        });

    </script>

    </div>


</html>
